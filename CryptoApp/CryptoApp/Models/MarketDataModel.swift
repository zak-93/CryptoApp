//
//  MarketDataModel.swift
//  CryptoApp
//
//  Created by Yashin Zahar on 22.09.2023.
//

import Foundation

/*
 
 URL: https://api.coingecko.com/api/v3/global

 "data": {
     "active_cryptocurrencies": 10109,
     "upcoming_icos": 0,
     "ongoing_icos": 49,
     "ended_icos": 3376,
     "markets": 868,
     "total_market_cap": {
       "btc": 41097836.35244943,
       "eth": 687157544.6259181,
       "ltc": 16927605648.964417,
       "bch": 5242074606.415132,
       "bnb": 5185199461.195637,
       "eos": 1908425344781.3389,
       "xrp": 2144145235594.7124,
       "xlm": 9555723564766.291,
       "link": 164125553793.71698,
       "dot": 272633598633.68356,
       "yfi": 213950207.1329448,
       "usd": 1093212125268.063,
       "aed": 4015242416715.1865,
       "ars": 382662396946993.75,
       "aud": 1700091345216.622,
       "bdt": 119902034435880.66,
       "bhd": 412092869892.5477,
       "bmd": 1093212125268.063,
       "brl": 5397625547298.553,
       "cad": 1472217836977.2473,
       "chf": 989783326096.4523,
       "clp": 972652692093502.2,
       "cny": 7980885799306.966,
       "czk": 25032043280750.54,
       "dkk": 7655240864644.249,
       "eur": 1026807141142.9058,
       "gbp": 890907755426.5825,
       "hkd": 8548924285656.892,
       "huf": 397101432283109.8,
       "idr": 16808111344430690,
       "ils": 4166778015459.205,
       "inr": 90613353289398.16,
       "jpy": 162114612480251.47,
       "krw": 1460183848638904.8,
       "kwd": 337700877980.1816,
       "lkr": 355903971662626.06,
       "mmk": 2294279688618222.5,
       "mxn": 18785266308362.133,
       "myr": 5126071655381.955,
       "ngn": 842057571608976.8,
       "nok": 11780626589404.447,
       "nzd": 1837469846938.4348,
       "php": 62107021747878.63,
       "pkr": 316152091672475.3,
       "pln": 4734427318292.529,
       "rub": 104968593916112.14,
       "sar": 4100355539940.0596,
       "sek": 12213244516948.912,
       "sgd": 1492811766993.046,
       "thb": 39406681863415.41,
       "try": 29681038257877.594,
       "twd": 35127637521963.9,
       "uah": 40347830368482.914,
       "vef": 109463330103.09128,
       "vnd": 26602074970620496,
       "zar": 20580074645324.14,
       "xdr": 828417563922.0088,
       "xag": 46020294910.13439,
       "xau": 567289636.0441039,
       "bits": 41097836352449.43,
       "sats": 4109783635244943
     },
     "total_volume": {
       "btc": 1409946.238923061,
       "eth": 23574360.15083979,
       "ltc": 580736506.7603532,
       "bch": 179840206.47910807,
       "bnb": 177888987.04257318,
       "eos": 65472476800.58282,
       "xrp": 73559334966.09454,
       "xlm": 327828851737.78015,
       "link": 5630666424.823209,
       "dot": 9353259225.158974,
       "yfi": 7340004.161701484,
       "usd": 37504901989.199875,
       "aed": 137751191942.60226,
       "ars": 13128024617299.373,
       "aud": 58325148250.07229,
       "bdt": 4113487168577.3687,
       "bhd": 14137697834.24082,
       "bmd": 37504901989.199875,
       "brl": 185176703081.47607,
       "cad": 50507476459.83556,
       "chf": 33956563212.001698,
       "clp": 33368861397830.953,
       "cny": 273800786481.9547,
       "czk": 858775994278.1024,
       "dkk": 262628863782.31415,
       "eur": 35226741727.66993,
       "gbp": 30564432351.588524,
       "hkd": 293288521080.0534,
       "huf": 13623385574777.629,
       "idr": 576637007608982.1,
       "ils": 142949933931.83472,
       "inr": 3108678412433.724,
       "jpy": 5561676925782.424,
       "krw": 50094625611645.38,
       "kwd": 11585526758.777767,
       "lkr": 12210021519383.262,
       "mmk": 78710007754752.27,
       "mxn": 644467396081.417,
       "myr": 175860485427.3585,
       "ngn": 28888525806201.043,
       "nok": 404158749610.1324,
       "nzd": 63038201758.54515,
       "php": 2130709776864.3289,
       "pkr": 10846251096006.863,
       "pln": 162424316784.82504,
       "rub": 3601164619174.498,
       "sar": 140671173591.8735,
       "sek": 419000601979.22076,
       "sgd": 51213993803.50807,
       "thb": 1351927687999.7769,
       "try": 1018269377982.2745,
       "twd": 1205126225663.0625,
       "uah": 1384215733132.0825,
       "vef": 3755365836.178588,
       "vnd": 912639177175083,
       "zar": 706042006544.7367,
       "xdr": 28420577144.081856,
       "xag": 1578821356.0981503,
       "xau": 19462043.74023562,
       "bits": 1409946238923.061,
       "sats": 140994623892306.1
     },
     "market_cap_percentage": {
       "btc": 47.42977667445562,
       "eth": 17.497715092983558,
       "usdt": 7.609146882457369,
       "bnb": 2.9668790969294774,
       "xrp": 2.483285151774319,
       "usdc": 2.35699973515383,
       "steth": 1.2657882753322174,
       "doge": 0.795419324464198,
       "ada": 0.7851172958686672,
       "sol": 0.7382803792187116
     },
     "market_cap_change_percentage_24h_usd": -1.4353807408803498,
     "updated_at": 1695368487
   }
 }
 */

struct GlobalData: Decodable {
    let data: MarketDataModel?
}

struct MarketDataModel: Decodable {
    let totalMarketCap: [String: Double]
    let totalVolume: [String: Double]
    let marketCapPercentage: [String: Double]
    let marketCapChangePercentage24HUsd: Double
    
    var marketCap: String {
        if let item = totalMarketCap.first(where: { $0.key == "usd"}) {
            return "$" + item.value.formattedWithAbbreviations()
        }
        return ""
    }
    
    var volume: String {
        if let item = totalVolume.first(where: { $0.key == "usd"}) {
            return "$" + item.value.formattedWithAbbreviations()
        }
        return ""
    }
    
    var btcDominate: String {
        if let item = marketCapPercentage.first(where: { $0.key == "btc"}) {
            return item.value.asPercentString()
        }
        return ""
    }
}
